<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Ghost Publisher - Cloud Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .card-stat { 
            transition: transform 0.2s; 
            cursor: pointer;
        }
        .card-stat:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .action-card {
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .action-card:hover {
            border-color: var(--bs-primary);
            transform: scale(1.02);
        }
        .log-output {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status-healthy { color: #28a745; }
        .status-degraded { color: #ffc107; }
        .status-unhealthy { color: #dc3545; }
        .production-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .cloud-notice {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
        <div class="container">
            <span class="navbar-brand">
                <i class="fas fa-robot text-primary"></i> Reddit Ghost Publisher
                <small class="text-muted">Cloud Dashboard</small>
                <span class="production-badge ms-2">VERCEL</span>
            </span>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-clock"></i> <span id="currentTime"></span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- í´ë¼ìš°ë“œ ë°°í¬ ì™„ë£Œ ì•ˆë‚´ -->
        <div class="cloud-notice">
            <h4><i class="fas fa-cloud-upload-alt"></i> í´ë¼ìš°ë“œ ë°°í¬ ì™„ë£Œ!</h4>
            <p>API ì„œë²„ê°€ Vercel Serverless Functionsë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤. 24/7 ìš´ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            <div class="row mt-3">
                <div class="col-md-4">
                    <strong><i class="fas fa-server"></i> Serverless API</strong><br>
                    <small>ìë™ ìŠ¤ì¼€ì¼ë§, ë¬´ì œí•œ ê°€ìš©ì„±</small>
                </div>
                <div class="col-md-4">
                    <strong><i class="fas fa-database"></i> Supabase DB</strong><br>
                    <small>PostgreSQL, ì‹¤ì‹œê°„ ë™ê¸°í™”</small>
                </div>
                <div class="col-md-4">
                    <strong><i class="fas fa-globe"></i> Global CDN</strong><br>
                    <small>ì „ ì„¸ê³„ ë¹ ë¥¸ ì ‘ê·¼</small>
                </div>
            </div>
        </div>

        <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-heartbeat"></i> ì‹œìŠ¤í…œ ìƒíƒœ</h5>
                        <small>Vercel Serverless - Real-time Monitoring</small>
                    </div>
                    <div class="card-body">
                        <div id="systemStatus">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                                </div>
                                <p class="mt-2">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="row mb-4" id="statsCards">
            <div class="col-md-3">
                <div class="card card-stat bg-primary text-white shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-database fa-2x mb-2"></i>
                        <h3 id="totalPosts">-</h3>
                        <p class="mb-0">ì´ ìˆ˜ì§‘ëœ í¬ìŠ¤íŠ¸</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-info text-white shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-robot fa-2x mb-2"></i>
                        <h3 id="aiProcessed">-</h3>
                        <p class="mb-0">AI ì²˜ë¦¬ ì™„ë£Œ</p>
                        <small id="pendingProcessing">ëŒ€ê¸°: -ê°œ</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-success text-white shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-blog fa-2x mb-2"></i>
                        <h3 id="published">-</h3>
                        <p class="mb-0">Ghost ë°œí–‰ ì™„ë£Œ</p>
                        <small id="pendingPublishing">ëŒ€ê¸°: -ê°œ</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-warning text-white shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-percentage fa-2x mb-2"></i>
                        <h3 id="successRate">-</h3>
                        <p class="mb-0">ì„±ê³µë¥ </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- íŒŒì´í”„ë¼ì¸ ì œì–´ -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-play-circle"></i> Cloud íŒŒì´í”„ë¼ì¸ ì œì–´</h5>
                        <small>Vercel Serverless Functionsë¡œ ì‹¤í–‰</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card action-card border-primary h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-download fa-3x text-primary mb-3"></i>
                                        <h6>Reddit ìˆ˜ì§‘</h6>
                                        <p class="text-muted small">ìƒˆë¡œìš´ Reddit í¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤</p>
                                        <button class="btn btn-primary" onclick="triggerCollection()">
                                            <i class="fas fa-play"></i> ìˆ˜ì§‘ ì‹œì‘
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card action-card border-info h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-brain fa-3x text-info mb-3"></i>
                                        <h6>AI ì²˜ë¦¬</h6>
                                        <p class="text-muted small">ìˆ˜ì§‘ëœ í¬ìŠ¤íŠ¸ë¥¼ AIë¡œ ìš”ì•½í•©ë‹ˆë‹¤</p>
                                        <button class="btn btn-info" onclick="processPost()">
                                            <i class="fas fa-robot"></i> AI ì²˜ë¦¬ ì‹œì‘
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card action-card border-success h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-rocket fa-3x text-success mb-3"></i>
                                        <h6>ì „ì²´ íŒŒì´í”„ë¼ì¸</h6>
                                        <p class="text-muted small">ìˆ˜ì§‘ â†’ AI ì²˜ë¦¬ â†’ Ghost ë°œí–‰</p>
                                        <button class="btn btn-success" onclick="runFullPipeline()">
                                            <i class="fas fa-play"></i> ì „ì²´ ì‹¤í–‰
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì•¡ì…˜ ë° ëª¨ë‹ˆí„°ë§ -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-tools"></i> ë¹ ë¥¸ ì•¡ì…˜</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="refreshData()">
                                <i class="fas fa-sync"></i> ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                            </button>
                            <button class="btn btn-outline-success" onclick="viewGhostBlog()">
                                <i class="fas fa-external-link-alt"></i> Ghost ë¸”ë¡œê·¸ ë³´ê¸°
                            </button>
                            <button class="btn btn-outline-warning" onclick="showLogs()">
                                <i class="fas fa-file-alt"></i> ì‹œìŠ¤í…œ ë¡œê·¸
                            </button>
                            <button class="btn btn-outline-info" onclick="checkHealth()">
                                <i class="fas fa-heartbeat"></i> í—¬ìŠ¤ì²´í¬
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-chart-line"></i> ì˜¤ëŠ˜ í™œë™</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <h4 class="text-primary" id="todayCollected">-</h4>
                                <p class="text-muted small">ìˆ˜ì§‘</p>
                            </div>
                            <div class="col-4">
                                <h4 class="text-info" id="todayProcessed">-</h4>
                                <p class="text-muted small">AI ì²˜ë¦¬</p>
                            </div>
                            <div class="col-4">
                                <h4 class="text-success" id="todayPublished">-</h4>
                                <p class="text-muted small">ë°œí–‰</p>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <small class="text-muted">
                                <i class="fas fa-server"></i> API ìƒíƒœ: <span id="apiStatus" class="badge bg-secondary">í™•ì¸ ì¤‘</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¡œê·¸ ì¶œë ¥ -->
        <div class="row mb-4" id="logSection" style="display: none;">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-terminal"></i> Cloud ì‹œìŠ¤í…œ ë¡œê·¸
                            <button class="btn btn-sm btn-outline-light float-end" onclick="clearLogs()">
                                <i class="fas fa-trash"></i> ì§€ìš°ê¸°
                            </button>
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="logOutput" class="log-output p-3">
                            Vercel Serverless ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cloud ì •ë³´ -->
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-success shadow-sm">
                    <i class="fas fa-cloud"></i> 
                    <strong>Cloud í™˜ê²½:</strong> 
                    Reddit Ghost Publisherê°€ Vercel Serverless Functionsì—ì„œ ì‹¤í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤. 
                    24/7 ìë™ ìš´ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    <br><small class="text-muted">
                        API URL: <span id="apiUrl">ë°°í¬ í›„ ì—…ë°ì´íŠ¸</span> |
                        Ghost ë¸”ë¡œê·¸: https://american-trends.ghost.io |
                        í™˜ê²½: Production | 
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì„¤ì • - Vercel ë°°í¬ URL
        const API_BASE_URL = 'https://reddit-crawl-mvp.vercel.app';  // í”„ë¡œë•ì…˜ URL
        
        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('ko-KR');
        }
        
        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        async function checkSystemStatus() {
            try {
                addLog('Vercel API ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤...', 'info');
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                const response = await fetch(`${API_BASE_URL}/api/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    displaySystemStatus(result.data);
                    addLog('âœ… Vercel API ì—°ê²° ì„±ê³µ!', 'success');
                    document.getElementById('apiStatus').className = 'badge bg-success';
                    document.getElementById('apiStatus').textContent = 'connected';
                } else {
                    throw new Error(result.error || 'Unknown API error');
                }
                
            } catch (error) {
                let errorMessage = '';
                let alertClass = 'warning';
                
                if (error.name === 'AbortError') {
                    errorMessage = 'API ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (10ì´ˆ)';
                    alertClass = 'danger';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'Vercel API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    alertClass = 'danger';
                } else {
                    errorMessage = `API ì˜¤ë¥˜: ${error.message}`;
                }
                
                document.getElementById('systemStatus').innerHTML = 
                    `<div class="alert alert-${alertClass}">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>ì—°ê²° ë¬¸ì œ:</strong> ${errorMessage}
                        <br><small class="mt-2 d-block">
                            <button class="btn btn-sm btn-outline-primary" onclick="checkSystemStatus()">
                                <i class="fas fa-redo"></i> ë‹¤ì‹œ ì‹œë„
                            </button>
                        </small>
                    </div>`;
                    
                document.getElementById('apiStatus').className = 'badge bg-danger';
                document.getElementById('apiStatus').textContent = 'disconnected';
                addLog(`âŒ ${errorMessage}`, 'error');
            }
        }
        
        function displaySystemStatus(data) {
            const status = data.overall_status;
            const statusClass = status === 'healthy' ? 'success' : status === 'degraded' ? 'warning' : 'danger';
            
            let servicesHtml = '';
            if (data.services) {
                servicesHtml = '<div class="row mt-3">';
                for (const [serviceName, serviceData] of Object.entries(data.services)) {
                    const serviceStatus = serviceData.status;
                    const serviceClass = serviceStatus === 'healthy' ? 'success' : serviceStatus === 'degraded' ? 'warning' : 'danger';
                    servicesHtml += `
                        <div class="col-md-2">
                            <div class="text-center">
                                <span class="badge bg-${serviceClass}">${serviceName}</span>
                            </div>
                        </div>
                    `;
                }
                servicesHtml += '</div>';
            }
            
            const statusHtml = `
                <div class="alert alert-${statusClass}">
                    <i class="fas fa-${status === 'healthy' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    <strong>ì‹œìŠ¤í…œ ìƒíƒœ: ${status.toUpperCase()}</strong>
                    <br><small>í™˜ê²½: Vercel Serverless | Cloud ë°°í¬</small>
                    ${servicesHtml}
                </div>
            `;
            
            document.getElementById('systemStatus').innerHTML = statusHtml;
            document.getElementById('apiStatus').className = `badge bg-${statusClass}`;
            document.getElementById('apiStatus').textContent = status;
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        async function updateStats() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                const response = await fetch(`${API_BASE_URL}/api/stats`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    
                    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ì™€ í•¨ê»˜ ì—…ë°ì´íŠ¸
                    updateStatWithAnimation('totalPosts', stats.total_posts);
                    updateStatWithAnimation('aiProcessed', stats.ai_processed);
                    updateStatWithAnimation('published', stats.published);
                    updateStatWithAnimation('successRate', stats.success_rate + '%');
                    
                    document.getElementById('pendingProcessing').textContent = `ëŒ€ê¸°: ${stats.total_posts - stats.ai_processed}ê°œ`;
                    document.getElementById('pendingPublishing').textContent = `ëŒ€ê¸°: ${stats.ai_processed - stats.published}ê°œ`;
                    
                    document.getElementById('todayCollected').textContent = stats.collected_today || 0;
                    document.getElementById('todayProcessed').textContent = stats.processed_today || stats.ai_processed;
                    document.getElementById('todayPublished').textContent = stats.published_today || stats.published;
                    
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
                    
                    addLog('ğŸ“Š í†µê³„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'success');
                } else {
                    throw new Error(result.error || 'Stats API returned error');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    addLog('â±ï¸ í†µê³„ ìš”ì²­ ì‹œê°„ ì´ˆê³¼', 'error');
                } else {
                    addLog(`âŒ í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
                
                // ì—ëŸ¬ ì‹œ ê¸°ë³¸ê°’ í‘œì‹œ
                ['totalPosts', 'aiProcessed', 'published', 'successRate'].forEach(id => {
                    if (document.getElementById(id).textContent === '-') {
                        document.getElementById(id).textContent = '?';
                    }
                });
            }
        }
        
        // í†µê³„ ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸
        function updateStatWithAnimation(elementId, newValue) {
            const element = document.getElementById(elementId);
            const currentValue = element.textContent;
            
            if (currentValue !== newValue.toString()) {
                element.style.transform = 'scale(1.1)';
                element.style.transition = 'transform 0.2s';
                
                setTimeout(() => {
                    element.textContent = newValue;
                    element.style.transform = 'scale(1)';
                }, 100);
            }
        }
        
        // Reddit ìˆ˜ì§‘ íŠ¸ë¦¬ê±°
        async function triggerCollection() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ìˆ˜ì§‘ ì¤‘...';
            button.disabled = true;
            
            addLog('ğŸš€ Reddit í¬ìŠ¤íŠ¸ ìˆ˜ì§‘ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                const response = await fetch(`${API_BASE_URL}/api/trigger/collect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        batch_size: 3,
                        subreddits: ['programming', 'technology', 'webdev']
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… ìˆ˜ì§‘ ì™„ë£Œ: ${result.data.collected_count}ê°œ í¬ìŠ¤íŠ¸ ìˆ˜ì§‘ë¨`, 'success');
                    addLog(`ğŸ“‹ ì‘ì—… ID: ${result.data.task_id}`, 'info');
                    
                    // Show collected posts with better formatting
                    if (result.data.posts && result.data.posts.length > 0) {
                        addLog('ğŸ“ ìˆ˜ì§‘ëœ í¬ìŠ¤íŠ¸:', 'info');
                        result.data.posts.forEach((post, index) => {
                            addLog(`  ${index + 1}. ${post.title} (r/${post.subreddit}) - ${post.score} points`, 'success');
                        });
                    }
                    
                    // Update stats after collection
                    setTimeout(updateStats, 1000);
                    
                    // Success animation
                    button.innerHTML = '<i class="fas fa-check"></i> ì™„ë£Œ!';
                    button.className = 'btn btn-success';
                    
                } else {
                    throw new Error(result.error || 'Collection API returned error');
                }
                
            } catch (error) {
                let errorMessage = '';
                if (error.name === 'AbortError') {
                    errorMessage = 'ìˆ˜ì§‘ ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (15ì´ˆ)';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else {
                    errorMessage = error.message;
                }
                
                addLog(`âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: ${errorMessage}`, 'error');
                
                // Error animation
                button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ì‹¤íŒ¨';
                button.className = 'btn btn-danger';
                
            } finally {
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'btn btn-primary';
                    button.disabled = false;
                }, 3000);
            }
        }
        
        // AI í¬ìŠ¤íŠ¸ ì²˜ë¦¬
        async function processPost() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì²˜ë¦¬ ì¤‘...';
            button.disabled = true;
            
            addLog('AI ì²˜ë¦¬ ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            addLog('í˜„ì¬ëŠ” ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ í†µí•´ AI ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'info');
            addLog('ê°œë³„ AI ì²˜ë¦¬ ê¸°ëŠ¥ì€ í–¥í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤.', 'info');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }
        
        // ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
        async function runFullPipeline() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì‹¤í–‰ ì¤‘...';
            button.disabled = true;
            
            addLog('ğŸ”„ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 20000); // 20ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                const response = await fetch(`${API_BASE_URL}/api/trigger/pipeline`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        batch_size: 2
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`ğŸ‰ íŒŒì´í”„ë¼ì¸ ì™„ë£Œ!`, 'success');
                    addLog(`ğŸ“‹ ì‘ì—… ID: ${result.data.task_id}`, 'info');
                    
                    const { collected, processed, published } = result.data.results;
                    addLog(`ğŸ“Š ê²°ê³¼: ìˆ˜ì§‘ ${collected}ê°œ â†’ ì²˜ë¦¬ ${processed}ê°œ â†’ ë°œí–‰ ${published}ê°œ`, 'success');
                    
                    // Show published posts with better formatting
                    if (result.data.posts && result.data.posts.length > 0) {
                        addLog('ğŸ“° ë°œí–‰ëœ í¬ìŠ¤íŠ¸:', 'info');
                        result.data.posts.forEach((post, index) => {
                            addLog(`  ${index + 1}. ${post.title} (r/${post.subreddit})`, 'success');
                            addLog(`     ğŸ”— ${post.ghost_url}`, 'info');
                        });
                    }
                    
                    // Update stats after pipeline
                    setTimeout(updateStats, 1000);
                    
                    // Success animation
                    button.innerHTML = '<i class="fas fa-check-circle"></i> ì™„ë£Œ!';
                    button.className = 'btn btn-success';
                    
                } else {
                    throw new Error(result.error || 'Pipeline API returned error');
                }
                
            } catch (error) {
                let errorMessage = '';
                if (error.name === 'AbortError') {
                    errorMessage = 'íŒŒì´í”„ë¼ì¸ ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (20ì´ˆ)';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else {
                    errorMessage = error.message;
                }
                
                addLog(`âŒ íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨: ${errorMessage}`, 'error');
                
                // Error animation
                button.innerHTML = '<i class="fas fa-times-circle"></i> ì‹¤íŒ¨';
                button.className = 'btn btn-danger';
                
            } finally {
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'btn btn-success';
                    button.disabled = false;
                }, 4000);
            }
        }
        
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ìƒˆë¡œê³ ì¹¨ ì¤‘...';
            button.disabled = true;
            
            addLog('ğŸ”„ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤...', 'info');
            
            try {
                // ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì•ˆì •ì„± í™•ë³´
                await checkSystemStatus();
                await new Promise(resolve => setTimeout(resolve, 500)); // 0.5ì´ˆ ëŒ€ê¸°
                await updateStats();
                
                addLog('âœ… ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
                
                // Success feedback
                button.innerHTML = '<i class="fas fa-check"></i> ì™„ë£Œ';
                button.className = 'btn btn-outline-success';
                
            } catch (error) {
                addLog(`âŒ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ${error.message}`, 'error');
                button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ì‹¤íŒ¨';
                button.className = 'btn btn-outline-danger';
            } finally {
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'btn btn-outline-primary';
                    button.disabled = false;
                }, 2000);
            }
        }
        
        // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
        function startConnectionMonitoring() {
            setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/health`, {
                        method: 'GET',
                        signal: AbortSignal.timeout(5000) // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
                    });
                    
                    if (response.ok) {
                        document.getElementById('apiStatus').className = 'badge bg-success';
                        document.getElementById('apiStatus').textContent = 'connected';
                    } else {
                        throw new Error('API not responding');
                    }
                } catch (error) {
                    document.getElementById('apiStatus').className = 'badge bg-danger';
                    document.getElementById('apiStatus').textContent = 'disconnected';
                }
            }, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬
        }
        
        // Ghost ë¸”ë¡œê·¸ ë³´ê¸°
        function viewGhostBlog() {
            addLog('Ghost ë¸”ë¡œê·¸ë¥¼ ìƒˆ ì°½ì—ì„œ ì—½ë‹ˆë‹¤...', 'info');
            window.open('https://american-trends.ghost.io', '_blank');
        }
        
        // ì‹¤ì œ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°
        async function loadRealLogs() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/logs`);
                const result = await response.json();
                
                if (result.success && result.data.logs) {
                    const logOutput = document.getElementById('logOutput');
                    logOutput.innerHTML = 'Real-time system logs:<br>';
                    
                    result.data.logs.forEach(log => {
                        const timestamp = new Date(log.timestamp).toLocaleTimeString('ko-KR');
                        const color = log.type === 'error' ? '#ff6b6b' : log.type === 'success' ? '#51cf66' : '#74c0fc';
                        logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${log.message}</div>`;
                    });
                    
                    logOutput.scrollTop = logOutput.scrollHeight;
                }
            } catch (error) {
                addLog(`ë¡œê·¸ ë¡œë”© ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ë¡œê·¸ í‘œì‹œ/ìˆ¨ê¸°ê¸°
        function showLogs() {
            const logSection = document.getElementById('logSection');
            logSection.style.display = logSection.style.display === 'none' ? 'block' : 'none';
            
            if (logSection.style.display === 'block') {
                addLog('ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ë¡œë”©í•©ë‹ˆë‹¤...', 'info');
                loadRealLogs();
            }
        }
        
        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLogs() {
            document.getElementById('logOutput').innerHTML = 'Vercel ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤...<br>';
        }
        
        // í—¬ìŠ¤ì²´í¬
        function checkHealth() {
            addLog('Vercel í—¬ìŠ¤ì²´í¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤...', 'info');
            checkSystemStatus();
        }
        
        // ì´ˆê¸°í™”
        function init() {
            updateTime();
            
            // ì´ˆê¸° ë¡œë”© ë©”ì‹œì§€
            addLog('ğŸš€ Reddit Ghost Publisher Vercel Dashboard ì‹œì‘', 'success');
            addLog('â˜ï¸ Serverless Functions ì—°ê²° ì¤‘...', 'info');
            
            // API URL í‘œì‹œ
            document.getElementById('apiUrl').textContent = API_BASE_URL;
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            setTimeout(async () => {
                await checkSystemStatus();
                await new Promise(resolve => setTimeout(resolve, 1000));
                await updateStats();
                addLog('âœ… ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            }, 1000);
            
            // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘
            startConnectionMonitoring();
            
            // ìë™ ì—…ë°ì´íŠ¸ (30ì´ˆë§ˆë‹¤)
            setInterval(() => {
                updateTime();
                updateStats();
            }, 30000);
            
            // ì‹œê°„ ì—…ë°ì´íŠ¸ (1ì´ˆë§ˆë‹¤)
            setInterval(updateTime, 1000);
            
            // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    addLog('ğŸ‘€ í˜ì´ì§€ í™œì„±í™” - ë°ì´í„° ìƒˆë¡œê³ ì¹¨', 'info');
                    updateStats();
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>