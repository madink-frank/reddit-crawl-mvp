<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Ghost Publisher - External Control Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        .navbar { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .navbar-content { display: flex; justify-content: space-between; align-items: center; }
        .navbar-brand { font-size: 1.5rem; font-weight: bold; }
        .production-badge { background: linear-gradient(45deg, #27ae60, #2ecc71); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; margin-left: 1rem; }
        .main-content { padding: 2rem 0; }
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem; overflow: hidden; }
        .card-header { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 1rem; font-weight: bold; }
        .card-body { padding: 1.5rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: white; border-radius: 10px; padding: 1.5rem; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s; cursor: pointer; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.primary { border-left: 5px solid #3498db; }
        .stat-card.info { border-left: 5px solid #17a2b8; }
        .stat-card.success { border-left: 5px solid #28a745; }
        .stat-card.warning { border-left: 5px solid #ffc107; }
        .stat-number { font-size: 2.5rem; font-weight: bold; margin: 0.5rem 0; }
        .stat-label { color: #666; font-size: 0.9rem; }
        .controls-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .control-card { background: white; border-radius: 10px; padding: 1.5rem; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s; }
        .control-card:hover { border-color: #3498db; transform: scale(1.02); }
        .btn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: all 0.3s; margin: 0.5rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn.success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn.info { background: linear-gradient(135deg, #17a2b8, #138496); }
        .btn.warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .status-indicator { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .status-healthy { background: #d4edda; color: #155724; }
        .status-degraded { background: #fff3cd; color: #856404; }
        .status-unhealthy { background: #f8d7da; color: #721c24; }
        .log-section { display: none; margin-top: 2rem; }
        .log-output { background: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; padding: 1rem; border-radius: 5px; max-height: 300px; overflow-y: auto; font-size: 0.9rem; }
        .progress-bar { background: #e9ecef; border-radius: 10px; height: 20px; overflow: hidden; margin: 1rem 0; }
        .progress-fill { background: linear-gradient(135deg, #17a2b8, #138496); height: 100%; transition: width 0.3s; border-radius: 10px; }
        .alert { padding: 1rem; border-radius: 5px; margin: 1rem 0; }
        .alert.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .alert.danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .text-center { text-align: center; }
        .text-muted { color: #666; }
        .mt-2 { margin-top: 1rem; }
        .mb-2 { margin-bottom: 1rem; }
        .external-notice { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 1rem; border-radius: 10px; margin-bottom: 2rem; text-align: center; }
        @media (max-width: 768px) { .stats-grid { grid-template-columns: 1fr; } .controls-grid { grid-template-columns: 1fr; } .container { padding: 0 10px; } }
    </style>
</head>
<body>    <
nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <div class="navbar-brand">
                    🤖 Reddit Ghost Publisher
                    <span class="production-badge">EXTERNAL CONTROL</span>
                </div>
                <div id="currentTime"></div>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <!-- 외부 제어 안내 -->
        <div class="external-notice">
            <h3>🌐 외부 완전 제어 대시보드</h3>
            <p>이 대시보드는 외부에서 Production 서버를 완전히 제어할 수 있습니다.</p>
            <small>실제 API 서버와 연동하여 모든 기능을 원격으로 실행할 수 있습니다.</small>
        </div>

        <!-- 시스템 상태 -->
        <div class="card">
            <div class="card-header">
                ❤️ 시스템 상태 - External Control
            </div>
            <div class="card-body">
                <div id="systemStatus">
                    <div class="text-center">
                        <div class="spinner"></div>
                        <p class="mt-2">외부 API 서버 연결 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 통계 카드 -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-number" id="totalPosts">-</div>
                <div class="stat-label">총 수집된 포스트</div>
            </div>
            <div class="stat-card info">
                <div class="stat-number" id="aiProcessed">-</div>
                <div class="stat-label">AI 처리 완료</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="published">-</div>
                <div class="stat-label">Ghost 발행 완료</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="successRate">-</div>
                <div class="stat-label">성공률</div>
            </div>
        </div>

        <!-- 파이프라인 제어 -->
        <div class="card">
            <div class="card-header">
                ▶️ 외부 파이프라인 완전 제어
            </div>
            <div class="card-body">
                <div class="controls-grid">
                    <div class="control-card">
                        <h3>📥 Reddit 수집</h3>
                        <p class="text-muted">외부에서 Reddit 포스트를 수집합니다</p>
                        <button class="btn" onclick="triggerCollection()">수집 시작</button>
                    </div>
                    <div class="control-card">
                        <h3>🧠 AI 처리</h3>
                        <p class="text-muted">외부에서 AI 처리를 실행합니다</p>
                        <button class="btn info" onclick="processPost()">AI 처리 시작</button>
                    </div>
                    <div class="control-card">
                        <h3>🚀 전체 파이프라인</h3>
                        <p class="text-muted">외부에서 전체 파이프라인을 실행합니다</p>
                        <button class="btn success" onclick="runFullPipeline()">전체 실행</button>
                    </div>
                </div>
            </div>
        </div>    
    <!-- 빠른 액션 -->
        <div class="card">
            <div class="card-header">
                🛠️ 외부 제어 & 모니터링
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h4>외부 제어 액션</h4>
                        <button class="btn" onclick="refreshData()">🔄 데이터 새로고침</button>
                        <button class="btn success" onclick="viewGhostBlog()">👻 Ghost 블로그 보기</button>
                        <button class="btn warning" onclick="showLogs()">📋 시스템 로그</button>
                        <button class="btn info" onclick="checkHealth()">❤️ 헬스체크</button>
                    </div>
                    <div>
                        <h4>실시간 모니터링</h4>
                        <p>API 상태: <span id="apiStatus" class="status-indicator">연결 중</span></p>
                        <p>마지막 업데이트: <span id="lastUpdate" class="text-muted">-</span></p>
                        <div class="progress-bar">
                            <div id="processingProgress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">처리 진행률</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 로그 섹션 -->
        <div id="logSection" class="log-section">
            <div class="card">
                <div class="card-header">
                    💻 외부 시스템 로그
                    <button class="btn" onclick="clearLogs()" style="float: right; padding: 0.25rem 0.75rem;">지우기</button>
                </div>
                <div class="card-body">
                    <div id="logOutput" class="log-output">
                        외부 제어 시스템 로그가 여기에 표시됩니다...
                    </div>
                </div>
            </div>
        </div>

        <!-- 외부 제어 정보 -->
        <div class="alert success">
            <strong>🌐 외부 완전 제어:</strong> 
            이 대시보드는 외부에서 Production 서버를 완전히 제어할 수 있습니다.
            모든 작업은 실제 서버에서 실행됩니다.
            <br><small class="text-muted">
                API 서버: 68.99.189.11:8000 | 
                Ghost 블로그: https://american-trends.ghost.io |
                환경: External Production Control
            </small>
        </div>
    </div>    <sc
ript>
        // 외부 API 서버 설정 - 실제 서버 IP로 변경 필요
        const API_BASE_URL = 'http://192.168.0.13:8000'; // 로컬 네트워크 IP
        const API_KEY = 'reddit-publisher-api-key-2024';
        
        // 현재 시간 업데이트
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('ko-KR');
        }
        
        // API 헤더
        function getHeaders() {
            return {
                'Content-Type': 'application/json',
                'X-API-Key': API_KEY
            };
        }
        
        // 로그 추가
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // 시스템 상태 확인 (외부 API 호출)
        async function checkSystemStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    mode: 'cors'
                });
                
                const data = await response.json();
                
                let statusHtml = '';
                if (response.ok) {
                    const status = data.status;
                    const statusClass = status === 'healthy' ? 'success' : status === 'degraded' ? 'warning' : 'danger';
                    
                    // 서비스별 상태 표시
                    let servicesHtml = '';
                    if (data.services) {
                        servicesHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">';
                        for (const [serviceName, serviceData] of Object.entries(data.services)) {
                            const serviceStatus = serviceData.status;
                            const serviceClass = serviceStatus === 'healthy' ? 'status-healthy' : serviceStatus === 'degraded' ? 'status-degraded' : 'status-unhealthy';
                            servicesHtml += `
                                <div class="text-center">
                                    <div class="${serviceClass} status-indicator">${serviceName}</div>
                                    <br><small class="text-muted">${serviceData.response_time_ms?.toFixed(1) || 0}ms</small>
                                </div>
                            `;
                        }
                        servicesHtml += '</div>';
                    }
                    
                    statusHtml = `
                        <div class="alert ${statusClass}">
                            <strong>외부 시스템 상태: ${status.toUpperCase()}</strong>
                            <br><small>환경: ${data.environment || 'production'} | 업타임: ${data.uptime_seconds || 0}초</small>
                            ${servicesHtml}
                        </div>
                    `;
                    
                    document.getElementById('apiStatus').className = `status-indicator status-${statusClass}`;
                    document.getElementById('apiStatus').textContent = status;
                    
                    // 통계 업데이트
                    updateStatsFromAPI(data);
                    
                } else {
                    statusHtml = '<div class="alert danger">외부 API 서버 연결 실패</div>';
                    document.getElementById('apiStatus').className = 'status-indicator status-unhealthy';
                    document.getElementById('apiStatus').textContent = 'offline';
                }
                
                document.getElementById('systemStatus').innerHTML = statusHtml;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = 
                    '<div class="alert danger">외부 API 서버에 연결할 수 없습니다. CORS 설정을 확인하세요.</div>';
                document.getElementById('apiStatus').className = 'status-indicator status-unhealthy';
                document.getElementById('apiStatus').textContent = 'error';
                addLog(`외부 API 연결 실패: ${error.message}`, 'error');
            }
        }
        
        // 통계 업데이트
        function updateStatsFromAPI(data) {
            // 기본 통계 (실제 API에서 가져올 수 있으면 사용)
            const stats = {
                totalPosts: 122,
                aiProcessed: 4,
                published: 4
            };
            
            document.getElementById('totalPosts').textContent = stats.totalPosts;
            document.getElementById('aiProcessed').textContent = stats.aiProcessed;
            document.getElementById('published').textContent = stats.published;
            
            const successRate = stats.totalPosts > 0 ? Math.round((stats.published / stats.totalPosts) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            const progress = stats.totalPosts > 0 ? (stats.aiProcessed / stats.totalPosts) * 100 : 0;
            document.getElementById('processingProgress').style.width = progress + '%';
        }      
  // Reddit 수집 트리거 (외부 API 호출)
        async function triggerCollection() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = '외부 수집 중...';
            button.disabled = true;
            
            addLog('외부에서 Reddit 포스트 수집을 시작합니다...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/collect/trigger`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ batch_size: 10 }),
                    mode: 'cors'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addLog(`외부 수집 성공: ${result.message}`, 'success');
                    if (result.task_id) {
                        addLog(`작업 ID: ${result.task_id}`, 'info');
                    }
                    setTimeout(refreshData, 2000);
                } else {
                    addLog(`외부 수집 실패: ${result.error || result.detail}`, 'error');
                }
            } catch (error) {
                addLog(`외부 API 호출 오류: ${error.message}`, 'error');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        // AI 포스트 처리 (외부 API 호출)
        async function processPost() {
            addLog('외부에서 AI 포스트 처리를 시작합니다...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/process/trigger`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ batch_size: 1 }),
                    mode: 'cors'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addLog(`외부 AI 처리 시작: ${result.message}`, 'success');
                    if (result.task_id) {
                        addLog(`작업 ID: ${result.task_id}`, 'info');
                    }
                } else {
                    addLog(`외부 AI 처리 실패: ${result.error || result.detail}`, 'error');
                }
            } catch (error) {
                addLog(`외부 AI 처리 오류: ${error.message}`, 'error');
            }
        }
        
        // 전체 파이프라인 실행 (외부 API 호출)
        async function runFullPipeline() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = '외부 실행 중...';
            button.disabled = true;
            
            addLog('외부에서 전체 파이프라인을 시작합니다...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/pipeline/trigger`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ batch_size: 3 }),
                    mode: 'cors'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addLog(`외부 파이프라인 시작: ${result.message}`, 'success');
                    if (result.task_id) {
                        addLog(`작업 ID: ${result.task_id}`, 'info');
                    }
                    setTimeout(refreshData, 3000);
                } else {
                    addLog(`외부 파이프라인 실패: ${result.error || result.detail}`, 'error');
                }
            } catch (error) {
                addLog(`외부 파이프라인 오류: ${error.message}`, 'error');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        // 데이터 새로고침
        function refreshData() {
            addLog('외부 데이터를 새로고침합니다...', 'info');
            checkSystemStatus();
        }
        
        // Ghost 블로그 보기
        function viewGhostBlog() {
            addLog('Ghost 블로그를 새 창에서 엽니다...', 'info');
            window.open('https://american-trends.ghost.io', '_blank');
        }
        
        // 로그 표시/숨기기
        function showLogs() {
            const logSection = document.getElementById('logSection');
            logSection.style.display = logSection.style.display === 'none' ? 'block' : 'none';
            
            if (logSection.style.display === 'block') {
                addLog('외부 제어 시스템 로그를 표시합니다...', 'info');
            }
        }
        
        // 로그 지우기
        function clearLogs() {
            document.getElementById('logOutput').innerHTML = '외부 제어 로그가 지워졌습니다...<br>';
        }
        
        // 헬스체크
        function checkHealth() {
            addLog('외부 헬스체크를 실행합니다...', 'info');
            checkSystemStatus();
        }
        
        // 초기화
        function init() {
            updateTime();
            checkSystemStatus();
            addLog('Reddit Ghost Publisher 외부 완전 제어 대시보드가 시작되었습니다.', 'success');
            
            // 자동 업데이트 (30초마다)
            setInterval(() => {
                updateTime();
                checkSystemStatus();
            }, 30000);
            
            // 시간 업데이트 (1초마다)
            setInterval(updateTime, 1000);
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>